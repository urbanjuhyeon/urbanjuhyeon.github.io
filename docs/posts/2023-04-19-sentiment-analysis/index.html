<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-04-19">
<meta name="description" content="대표적인 한국어 감성 분석 API를 제공하는 구글과 네이버 성능 비교">

<title>Juhyeon Park - 한국어 감성 분석 비교: 네이버 vs 구글</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.27/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Juhyeon Park</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Juhyeon Park</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html" rel="" target="">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jhyeonpark" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">한국어 감성 분석 비교: 네이버 vs 구글</h1>
                  <div>
        <div class="description">
          <p>대표적인 한국어 감성 분석 API를 제공하는 구글과 네이버 성능 비교</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 19, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#들어가기" id="toc-들어가기" class="nav-link active" data-scroll-target="#들어가기">들어가기</a></li>
  <li><a href="#데이터-준비하기" id="toc-데이터-준비하기" class="nav-link" data-scroll-target="#데이터-준비하기">1. 데이터 준비하기</a></li>
  <li><a href="#감성분석" id="toc-감성분석" class="nav-link" data-scroll-target="#감성분석">2. 감성분석</a>
  <ul class="collapse">
  <li><a href="#네이버-감성분석" id="toc-네이버-감성분석" class="nav-link" data-scroll-target="#네이버-감성분석">2.1. 네이버 감성분석</a>
  <ul class="collapse">
  <li><a href="#감성분석-준비" id="toc-감성분석-준비" class="nav-link" data-scroll-target="#감성분석-준비">감성분석 준비</a></li>
  <li><a href="#r을-활용한-네이버-감성분석" id="toc-r을-활용한-네이버-감성분석" class="nav-link" data-scroll-target="#r을-활용한-네이버-감성분석">R을 활용한 네이버 감성분석</a></li>
  </ul></li>
  <li><a href="#구글-감성분석" id="toc-구글-감성분석" class="nav-link" data-scroll-target="#구글-감성분석">2.2. 구글 감성분석</a></li>
  </ul></li>
  <li><a href="#감성분석-비교" id="toc-감성분석-비교" class="nav-link" data-scroll-target="#감성분석-비교">3. 감성분석 비교</a>
  <ul class="collapse">
  <li><a href="#분류-정확도-요약" id="toc-분류-정확도-요약" class="nav-link" data-scroll-target="#분류-정확도-요약">3.1. 분류 정확도 요약</a></li>
  <li><a href="#비교-데이터셋-만들기" id="toc-비교-데이터셋-만들기" class="nav-link" data-scroll-target="#비교-데이터셋-만들기">3.2. 비교 데이터셋 만들기</a></li>
  <li><a href="#감성분석-상세" id="toc-감성분석-상세" class="nav-link" data-scroll-target="#감성분석-상세">3.3. 감성분석 상세</a>
  <ul class="collapse">
  <li><a href="#네이버-감성분석-1" id="toc-네이버-감성분석-1" class="nav-link" data-scroll-target="#네이버-감성분석-1">네이버 감성분석</a></li>
  <li><a href="#잘못-분류한-문장" id="toc-잘못-분류한-문장" class="nav-link" data-scroll-target="#잘못-분류한-문장">잘못 분류한 문장</a></li>
  <li><a href="#구글-감성분석-1" id="toc-구글-감성분석-1" class="nav-link" data-scroll-target="#구글-감성분석-1">구글 감성분석</a></li>
  <li><a href="#잘못분류한-문장들" id="toc-잘못분류한-문장들" class="nav-link" data-scroll-target="#잘못분류한-문장들">잘못분류한 문장들</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="들어가기" class="level1">
<h1>들어가기</h1>
<p>한국어 자연어 처리에서 감성 분석 서비스를 하는 구글과 네이버의 성능을 비교한다.</p>
<hr>
</section>
<section id="데이터-준비하기" class="level1">
<h1>1. 데이터 준비하기</h1>
<p>분석에 필요할 패키지를 불러온다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyverse"</span>,  <span class="st">"tidytext"</span>, <span class="st">"data.table"</span>, <span class="st">"knitr"</span>, <span class="st">"gt"</span>, <span class="st">"scales"</span>, <span class="st">"cvms"</span>, <span class="st">"DT"</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"httr"</span>, <span class="st">"jsonlite"</span>, <span class="st">"future"</span>, <span class="st">"furrr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>분석에 쓸 데이터를 <a href="data/sample.csv">여기</a>에서 다운 받아 불러온다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>db_sent_1a <span class="ot">&lt;-</span> <span class="fu">fread</span>(<span class="st">'data/sample.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>데이터는 구글 리뷰 문장(sent_content)을 긍정과 중립, 부정으로 라벨링(label)하고 구글 자연어 처리의 감성분석 점수(score)로 구성된다.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">sent_content</th>
<th style="text-align: left;">label</th>
<th style="text-align: right;">senti_score_google</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">탁트인 한강 전망이 좋아요</td>
<td style="text-align: left;">긍정</td>
<td style="text-align: right;">0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">물난리 후 첫주말에 갔는데</td>
<td style="text-align: left;">중립</td>
<td style="text-align: right;">-0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">교통,주차 너무힘들어요</td>
<td style="text-align: left;">부정</td>
<td style="text-align: right;">0.0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>위 데이터에서 긍정과 중립, 부정을 각각 200개씩 무작위로 샘플링한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">777</span>) <span class="co"># 난수 고정</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>db_sent_1b <span class="ot">&lt;-</span> db_sent_1a <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(label) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">200</span>) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(label) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="감성분석" class="level1">
<h1>2. 감성분석</h1>
<section id="네이버-감성분석" class="level2">
<h2 class="anchored" data-anchor-id="네이버-감성분석">2.1. 네이버 감성분석</h2>
<section id="감성분석-준비" class="level3">
<h3 class="anchored" data-anchor-id="감성분석-준비">감성분석 준비</h3>
<p>CLOVA Sentiment 서비스 설명과 가이드라인은 <a href="https://medium.com/naver-cloud-platform/%EC%9D%B4%EB%A0%87%EA%B2%8C-%EC%82%AC%EC%9A%A9%ED%95%98%EC%84%B8%EC%9A%94-%ED%85%8D%EC%8A%A4%ED%8A%B8-%EA%B0%90%EC%A0%95-%EB%B6%84%EC%84%9D-%EC%84%9C%EB%B9%84%EC%8A%A4-%EA%B5%AC%ED%98%84%ED%95%98%EA%B8%B0-clova-sentiment-%ED%99%9C%EC%9A%A9%EA%B8%B0-5d9db7b0209b">여기</a>에서 볼 수 있다. 콘솔 접속과 서비스 활성화, 인증정보 등을 따라하면 된다.</p>
</section>
<section id="r을-활용한-네이버-감성분석" class="level3">
<h3 class="anchored" data-anchor-id="r을-활용한-네이버-감성분석">R을 활용한 네이버 감성분석</h3>
<p>아래 코드로 할당받은 네이버 감성분석 API를 활용하여 샘플 데이터를 감성분석한다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define API endpoint and headers</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://naveropenapi.apigw.ntruss.com/sentiment-analysis/v1/analyze"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>client_id <span class="ot">=</span> <span class="st">""</span>     <span class="co"># 할당된 클라이언트 ID</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>client_secret <span class="ot">=</span> <span class="st">""</span> <span class="co"># 할당된 API key</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>headers_user <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"X-NCP-APIGW-API-KEY-ID"</span> <span class="ot">=</span> client_id,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"X-NCP-APIGW-API-KEY"</span> <span class="ot">=</span> client_secret,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Content-Type"</span> <span class="ot">=</span> <span class="st">"application/json"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>db_sent_1c <span class="ot">&lt;-</span> db_sent_1b <span class="sc">%&gt;%</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(id)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>db_sent_2a <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">future_map</span>(db_sent_1c, <span class="cf">function</span>(x){</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>    sent_content_input <span class="ot">&lt;-</span> x<span class="sc">$</span>sent_content</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>    seti_analysis_respon <span class="ot">&lt;-</span> <span class="fu">POST</span>(</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">url =</span> <span class="st">"https://naveropenapi.apigw.ntruss.com/sentiment-analysis/v1/analyze"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">body =</span> <span class="fu">toJSON</span>(<span class="fu">list</span>(<span class="at">content =</span> sent_content_input) , <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>, <span class="at">pretty =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_headers</span>(<span class="at">.headers =</span> headers_user),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">encode =</span> <span class="st">"json"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">content</span>()</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    doc_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">doc_content =</span> sent_content_input,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">doc_senti =</span> seti_analysis_respon<span class="sc">$</span>document<span class="sc">$</span>sentiment,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">doc_confi_neg =</span> seti_analysis_respon<span class="sc">$</span>document<span class="sc">$</span>confidence<span class="sc">$</span>negative,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">doc_confi_posi =</span> seti_analysis_respon<span class="sc">$</span>document<span class="sc">$</span>confidence<span class="sc">$</span>positive,</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">doc_confi_neut =</span> seti_analysis_respon<span class="sc">$</span>document<span class="sc">$</span>confidence<span class="sc">$</span>neutral</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create a data.table of sentence-level information</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    sent_dt <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_content =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>content),</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_offset =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>offset),</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_length =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>length),</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_sentiment =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>sentiment),</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_confi_neg =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>confidence<span class="sc">$</span>negative),</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_confi_posi =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>confidence<span class="sc">$</span>positive),</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_confi_neut =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>confidence<span class="sc">$</span>neutral),</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_highlight_offset =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>highlights[[<span class="dv">1</span>]]<span class="sc">$</span>offset),</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">sent_highlight_length =</span> <span class="fu">sapply</span>(seti_analysis_respon<span class="sc">$</span>sentences, <span class="cf">function</span>(x) x<span class="sc">$</span>highlights[[<span class="dv">1</span>]]<span class="sc">$</span>length)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="st">"end"</span>)</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    comb_dt <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">id =</span> x<span class="sc">$</span>id, doc_dt, sent_dt)</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  }))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>감성분석 결과는 다음과 같다. 여기서 doc와 senti로 시작하면 각각 문서와 그 문서를 구성하는 문장으로 나타낸다. 네이버 클로버 감성분석은 분석하는 문서(doc)의 문장을 자동으로 분류해준다.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 1%">
<col style="width: 11%">
<col style="width: 4%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 11%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">doc_content</th>
<th style="text-align: left;">doc_senti</th>
<th style="text-align: right;">doc_confi_neg</th>
<th style="text-align: right;">doc_confi_posi</th>
<th style="text-align: right;">doc_confi_neut</th>
<th style="text-align: left;">sent_content</th>
<th style="text-align: right;">sent_offset</th>
<th style="text-align: right;">sent_length</th>
<th style="text-align: left;">sent_sentiment</th>
<th style="text-align: right;">sent_confi_neg</th>
<th style="text-align: right;">sent_confi_posi</th>
<th style="text-align: right;">sent_confi_neut</th>
<th style="text-align: right;">sent_highlight_offset</th>
<th style="text-align: right;">sent_highlight_length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">그늘도 많고 쉴자리도 많아요.</td>
<td style="text-align: left;">positive</td>
<td style="text-align: right;">0.0002367</td>
<td style="text-align: right;">99.99958</td>
<td style="text-align: right;">0.0001859</td>
<td style="text-align: left;">그늘도 많고 쉴자리도 많아요.</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: left;">positive</td>
<td style="text-align: right;">0.0000142</td>
<td style="text-align: right;">0.9999746</td>
<td style="text-align: right;">0.0000112</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">15</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">공기좋음</td>
<td style="text-align: left;">positive</td>
<td style="text-align: right;">0.0367223</td>
<td style="text-align: right;">99.95812</td>
<td style="text-align: right;">0.0051644</td>
<td style="text-align: left;">공기좋음</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: left;">positive</td>
<td style="text-align: right;">0.0022033</td>
<td style="text-align: right;">0.9974868</td>
<td style="text-align: right;">0.0003099</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">맑은하늘을 맘껏볼수있는곳</td>
<td style="text-align: left;">positive</td>
<td style="text-align: right;">0.0001375</td>
<td style="text-align: right;">99.99956</td>
<td style="text-align: right;">0.0003061</td>
<td style="text-align: left;">맑은하늘을 맘껏볼수있는곳</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">positive</td>
<td style="text-align: right;">0.0000083</td>
<td style="text-align: right;">0.9999734</td>
<td style="text-align: right;">0.0000184</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">13</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="구글-감성분석" class="level2">
<h2 class="anchored" data-anchor-id="구글-감성분석">2.2. 구글 감성분석</h2>
<p>구글 감성 분석은 <a href="https://brunch.co.kr/@mapthecity/25">여기</a>에서 자세히 배울 수 있다. 네이버 감성분석과 같이 R를 활용하여 구글 감성 분석 API를 쓰는 방법은 추후에 업데이트하고자 한다.</p>
</section>
</section>
<section id="감성분석-비교" class="level1">
<h1>3. 감성분석 비교</h1>
<section id="분류-정확도-요약" class="level2">
<h2 class="anchored" data-anchor-id="분류-정확도-요약">3.1. 분류 정확도 요약</h2>
<p>네이버 감성분석은 F1 점수가 0.84로 구글 감성분석 0.642보다 더 높았다.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 25%">
<col style="width: 22%">
<col style="width: 19%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">지표</th>
<th style="text-align: left;">네이버 감성분석</th>
<th style="text-align: left;">구글 감성분석</th>
<th style="text-align: left;">구글 감성분석(조정 후)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">F1-score</td>
<td style="text-align: left;">0.840</td>
<td style="text-align: left;">0.642</td>
<td style="text-align: left;">0.718</td>
</tr>
<tr class="even">
<td style="text-align: left;">Balanced Accuracy</td>
<td style="text-align: left;">0.879</td>
<td style="text-align: left;">0.736</td>
<td style="text-align: left;">0.788</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="비교-데이터셋-만들기" class="level2">
<h2 class="anchored" data-anchor-id="비교-데이터셋-만들기">3.2. 비교 데이터셋 만들기</h2>
<p>분석할 감성분석 결과 DB를 만들어준다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>db_sent_2b <span class="ot">&lt;-</span> <span class="fu">unique</span>(db_sent_2a, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, doc_senti)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>db_sent_f <span class="ot">&lt;-</span> db_sent_1b <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_sent_2b, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">senti_label_google =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(senti_score_google, <span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">~</span> <span class="st">"긍정"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(senti_score_google, <span class="sc">-</span><span class="fl">0.25</span>, <span class="fl">0.25</span>) <span class="sc">~</span> <span class="st">"중립"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"부정"</span>),</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">senti_label_naver =</span> <span class="fu">case_when</span>(</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>      doc_senti <span class="sc">==</span> <span class="st">"positive"</span> <span class="sc">~</span> <span class="st">"긍정"</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>      doc_senti <span class="sc">==</span> <span class="st">"neutral"</span> <span class="sc">~</span> <span class="st">"중립"</span>,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"부정"</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, sent_content, senti_label_google, senti_label_naver, label) <span class="sc">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"senti_label_google"</span>, <span class="st">"senti_label_naver"</span>, <span class="st">"label"</span>), factor, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"부정"</span>, <span class="st">"중립"</span>, <span class="st">"긍정"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>conf_mat_google <span class="ot">&lt;-</span> <span class="fu">confusion_matrix</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">targets =</span> db_sent_f<span class="sc">$</span>label,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictions =</span> db_sent_f<span class="sc">$</span>senti_label_google</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>conf_mat_naver <span class="ot">&lt;-</span> <span class="fu">confusion_matrix</span>(</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">targets =</span> db_sent_f<span class="sc">$</span>label,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">predictions =</span> db_sent_f<span class="sc">$</span>senti_label_naver</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="감성분석-상세" class="level2">
<h2 class="anchored" data-anchor-id="감성분석-상세">3.3. 감성분석 상세</h2>
<section id="네이버-감성분석-1" class="level3">
<h3 class="anchored" data-anchor-id="네이버-감성분석-1">네이버 감성분석</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_confusion_matrix</span>(conf_mat_naver<span class="sc">$</span><span class="st">`</span><span class="at">Confusion Matrix</span><span class="st">`</span>[[<span class="dv">1</span>]], </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">class_order =</span> <span class="fu">c</span>(<span class="st">"긍정"</span>, <span class="st">"중립"</span>, <span class="st">"부정"</span>),</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">add_sums =</span> <span class="cn">TRUE</span>)  <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"네이버 감성분석 분류 정확도 결과"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot_confusion_matrix(conf_mat_naver$`Confusion Matrix`[[1]], :
'ggimage' is missing. Will not plot arrows and zero-shading.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot_confusion_matrix(conf_mat_naver$`Confusion Matrix`[[1]], :
'rsvg' is missing. Will not plot arrows and zero-shading.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot_confusion_matrix(conf_mat_naver$`Confusion Matrix`[[1]], :
'ggnewscale' is missing. Will not use palette for sum tiles.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="잘못-분류한-문장" class="level3">
<h3 class="anchored" data-anchor-id="잘못-분류한-문장">잘못 분류한 문장</h3>
<section id="중립-문장을-긍정으로-잘못-분류한-경우" class="level4">
<h4 class="anchored" data-anchor-id="중립-문장을-긍정으로-잘못-분류한-경우">중립 문장을 긍정으로 잘못 분류한 경우</h4>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-4340c814079ac0265ac2" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-4340c814079ac0265ac2">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],[10,25,29,34,51,54,62,66,70,75,85,96,98,107,111,122,146,148,150,151,161,176,178,198,199],["늘 산책하는 공원","산책하기에 딱좋아요","도움이 되는 곳입니다","가을 하늘이 높고 좋네요.","초등 남아가 아주 재밌어해요","여기 자주 오세여!","가을 지니 가야 좋을듯","작은동산 좋음","의외의 장소에서 기쁨을","애완견 데리고 산책하기 좋은 곳","아이들 놀기 좋은곳입니다.","배드민턴 맛집","둘레길 걷기도 좋습니다.","주말마다 농구하는곳","멍때리고 앉아있기 좋음","아기있는 가족에게 강추","밤에 야경이 그만입니다","멋짐ㅋ 섬나라로 초대","산책하기 좋죠","갈대가 진짜예뻣어요","사람도 많고 잘꾸며놓았습니다.","지역 산책로로서는 최고","러닝 산책 하러 가기 좋아요.","날이좋아서ㅡ","도심에서 이런분위기 좋아요"],["긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정","긍정"],["중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립"],[0.0013434663,0.12769963,0.32105058,2.0465677,0.06899399,0.6806139,0.7333088,0.5744711,0.12775072,0.0029285706,0.090973206,0.74002826,0.0037368052,0.057509724,0.007763055,0.6817497,0.0020598955,0.012779236,0.23061922,0.04104916,3.7606583,0.21470729,0.39341545,0.004618701,0.056183964],[99.99676,99.80855,99.48768,97.64394,99.87591,99.14951,99.13406,99.37123,99.781,99.99578,99.79807,99.223465,99.9918,99.92091,99.98771,99.22495,99.996635,99.9676,99.73022,99.92266,96.13996,99.64698,99.54218,99.99437,99.83218],[0.0018964893,0.06374981,0.19127089,0.30948737,0.05509995,0.16987474,0.13262598,0.054298148,0.09125301,0.0012928466,0.1109565,0.03651005,0.0044659935,0.021576924,0.0045294543,0.09330027,0.001301773,0.019623445,0.039160945,0.036290936,0.09938005,0.13831398,0.06439831,0.0010085935,0.11164253]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>sent_content<\/th>\n      <th>label<\/th>\n      <th>senti_label_naver<\/th>\n      <th>doc_confi_posi<\/th>\n      <th>doc_confi_neut<\/th>\n      <th>doc_confi_neg<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"lengthMenu":[10,20,50],"dom":"tp","columnDefs":[{"className":"dt-right","targets":[1,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>db_sent_2b <span class="ot">&lt;-</span> <span class="fu">unique</span>(db_sent_2a, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, doc_senti, doc_confi_posi, doc_confi_neut, doc_confi_neg)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>db_sent_f <span class="ot">&lt;-</span> db_sent_1b <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(db_sent_2b, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">senti_label_google =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(senti_score_google, <span class="fl">0.25</span>, <span class="dv">1</span>) <span class="sc">~</span> <span class="st">"긍정"</span>,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">between</span>(senti_score_google, <span class="sc">-</span><span class="fl">0.25</span>, <span class="fl">0.25</span>) <span class="sc">~</span> <span class="st">"중립"</span>,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"부정"</span>),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">senti_label_naver =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      doc_senti <span class="sc">==</span> <span class="st">"positive"</span> <span class="sc">~</span> <span class="st">"긍정"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>      doc_senti <span class="sc">==</span> <span class="st">"neutral"</span> <span class="sc">~</span> <span class="st">"중립"</span>,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"부정"</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="fu">data.table</span>(db_sent_f)[label <span class="sc">==</span> <span class="st">"부정"</span> <span class="sc">&amp;</span> senti_label_naver <span class="sc">==</span> <span class="st">"중립"</span>][</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  , .(id, sent_content, label, senti_label_naver, doc_confi_posi, doc_confi_neut, doc_confi_neg)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id                       sent_content label senti_label_naver
 1: 210       힐링하러 갔다가 헬링 당한 곳  부정              중립
 2: 216             타는 장소도 너무 멀고,  부정              중립
 3: 217       인파도 많고 난잡하기도 하다.  부정              중립
 4: 221       입장료가 비싼편이라 생각해요  부정              중립
 5: 226          살짝 실망스러운 모습이라.  부정              중립
 6: 230                  넘 사람들이 많다.  부정              중립
 7: 231                인성개씨발동네 ㄹㅇ  부정              중립
 8: 236           노잼이고 막 볼것도 없다.  부정              중립
 9: 246              불볕더위에 땡볓이지만  부정              중립
10: 251                   주차장이 없어요.  부정              중립
11: 260          대중교통이 차라리 나아요.  부정              중립
12: 269            걍 집에서 잠이나 자세요  부정              중립
13: 271         지금 시즌은 별로인 듯해요.  부정              중립
14: 274                     주차장 비좁음.  부정              중립
15: 275                      밤엔 넘 춥다.  부정              중립
16: 277                     사람 너무많다.  부정              중립
17: 279    기대가 커서 그런가 실망도 크다.  부정              중립
18: 280 볼것도없고그냥뭐동네뒷산갔다온느낌  부정              중립
19: 302                      너무 사람많음  부정              중립
20: 310                주차 완전 힘듭니다.  부정              중립
21: 315          주차가 가장 짜증 났습니다  부정              중립
22: 316                  개선이 필요합니다  부정              중립
23: 325                        극악의 주차  부정              중립
24: 335                차도 너무 막혔네요.  부정              중립
25: 340                주차 진짜 쒯입니다.  부정              중립
26: 341      맞기라도 하면.상상도 싫으네요  부정              중립
27: 343         저녁 때 사람이 많긴 하지만  부정              중립
28: 358           시설이 노후됫습니다 ㅠㅜ  부정              중립
29: 360              리모델링이 시급하네요  부정              중립
30: 363   ㅜㅠ 바람도 춥고 해서 아쉬웠네요  부정              중립
31: 364         집회때문에 너무 불편했어요  부정              중립
32: 365   광장에 사람들이 넘 많이 모였어요  부정              중립
33: 372                       쓰레기냄새남  부정              중립
34: 373                  의자도 별로 없고,  부정              중립
35: 381                사람구경만 졸라하다  부정              중립
36: 391                    찾는 이가 없음.  부정              중립
37: 396                       주차공간협소  부정              중립
38: 398                            주차 헬  부정              중립
     id                       sent_content label senti_label_naver
    doc_confi_posi doc_confi_neut doc_confi_neg
 1:    0.002516054       99.99630   0.001187555
 2:    0.076974176       97.06975   2.853277200
 3:    0.064776120       99.74305   0.192171300
 4:    0.008725748       99.98264   0.008629889
 5:    0.100952960       99.67683   0.222217780
 6:    0.271925180       98.22211   1.505968600
 7:    0.123892054       93.11234   6.763764400
 8:    0.023809950       99.92928   0.046910760
 9:    0.066535760       99.89360   0.039866920
10:    0.006073157       99.67338   0.320546840
11:    0.062801205       99.88726   0.049936870
12:    0.392281380       99.26622   0.341496530
13:    0.023040438       99.92218   0.054779444
14:    0.789424060       61.47467  37.735905000
15:    0.002088725       99.99641   0.001495643
16:    0.145121800       99.69920   0.155682190
17:    0.055910440       99.67062   0.273466380
18:    0.309557470       99.57802   0.112426504
19:    0.017323079       99.94631   0.036366973
20:    0.601401900       97.76577   1.632826100
21:    0.789424060       61.47467  37.735905000
22:    0.496102060       99.48928   0.014619959
23:    0.193368870       99.60049   0.206140460
24:    0.022184083       99.87048   0.107330120
25:    0.021959830       99.90194   0.076099320
26:    0.004861866       99.98780   0.007340889
27:    0.017429445       96.66999   3.312579900
28:    0.091496530       99.81611   0.092393720
29:    0.070926390       99.47028   0.458789140
30:    0.351080270       98.24281   1.406106100
31:    0.026297357       99.95812   0.015587593
32:    0.430049840       93.90658   5.663370600
33:    0.068197310       99.88186   0.049946714
34:    0.265411100       99.56754   0.167052850
35:    0.660176630       92.43296   6.906865600
36:    0.182308810       99.71406   0.103631936
37:    0.036754236       99.89362   0.069629155
38:    0.248254840       99.72199   0.029763816
    doc_confi_posi doc_confi_neut doc_confi_neg</code></pre>
</div>
</div>
</section>
</section>
<section id="구글-감성분석-1" class="level3">
<h3 class="anchored" data-anchor-id="구글-감성분석-1">구글 감성분석</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_confusion_matrix</span>(conf_mat_google<span class="sc">$</span><span class="st">`</span><span class="at">Confusion Matrix</span><span class="st">`</span>[[<span class="dv">1</span>]], </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">class_order =</span> <span class="fu">c</span>(<span class="st">"긍정"</span>, <span class="st">"중립"</span>, <span class="st">"부정"</span>),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">add_sums =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot_confusion_matrix(conf_mat_google$`Confusion Matrix`[[1]], :
'ggimage' is missing. Will not plot arrows and zero-shading.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot_confusion_matrix(conf_mat_google$`Confusion Matrix`[[1]], :
'rsvg' is missing. Will not plot arrows and zero-shading.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in plot_confusion_matrix(conf_mat_google$`Confusion Matrix`[[1]], :
'ggnewscale' is missing. Will not use palette for sum tiles.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="구글-감성분석-parameter" class="level4">
<h4 class="anchored" data-anchor-id="구글-감성분석-parameter">구글 감성분석 parameter</h4>
<p>문장별로 감성점수를 제공하는 구글 자연어처리 서비스에서 점수를 긍정과 부정, 중립으로 나누는 기준이 모호하다는 생각이 들었다. 아래 예시와 같이, ‘싸늘하다’ 등은 부정적으로 느껴지지만 구글 감성점수 기준에서는 중립에 속한다.</p>
<p><img src="image/ex_google_senti.png" class="img-fluid" style="width:80.0%"></p>
<p>긍정과 긍정을 결정하는 기준을 다르게해서 구글 감성분석 라벨을 다시 매겨보았다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>list_parameter <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold_posi =</span> <span class="fu">seq</span>(<span class="fl">0.25</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span>),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">threshold_neg =</span> <span class="fu">seq</span>(<span class="fl">0.25</span>, <span class="sc">-</span><span class="fl">0.95</span>, <span class="sc">-</span><span class="fl">0.05</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_split</span>(id)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>result_senti_google_param <span class="ot">&lt;-</span> <span class="fu">rbindlist</span>(<span class="fu">future_map</span>(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  list_parameter, <span class="cf">function</span>(x){</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    db_sent_f <span class="ot">&lt;-</span> db_sent_1b <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(db_sent_2b, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">senti_label_google =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(senti_score_google, x<span class="sc">$</span>threshold_posi, <span class="dv">1</span>) <span class="sc">~</span> <span class="st">"긍정"</span>,</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">between</span>(senti_score_google, <span class="sc">-</span><span class="dv">1</span>, x<span class="sc">$</span>threshold_neg) <span class="sc">~</span> <span class="st">"부정"</span>,</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>          <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"중립"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(id, sent_content, senti_label_google, label) <span class="sc">%&gt;%</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">"senti_label_google"</span>, <span class="st">"label"</span>), factor, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"부정"</span>, <span class="st">"중립"</span>, <span class="st">"긍정"</span>))</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>    conf_mat_google <span class="ot">&lt;-</span> <span class="fu">confusion_matrix</span>(</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">targets =</span> db_sent_f<span class="sc">$</span>label,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">predictions =</span> db_sent_f<span class="sc">$</span>senti_label_google)</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x, <span class="at">F1 =</span> conf_mat_google<span class="sc">$</span>F1, <span class="st">`</span><span class="at">Balanced Accuracy</span><span class="st">`</span> <span class="ot">=</span> conf_mat_google<span class="sc">$</span><span class="st">`</span><span class="at">Balanced Accuracy</span><span class="st">`</span>)</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>내가 매긴 라벨이 정답이라는 가정 하에, 기준 값을 조정하면 F1 점수는 0.7181로 기준 0.5534에서 높아진다.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">id</th>
<th style="text-align: left;">F1</th>
<th style="text-align: right;">threshold_posi</th>
<th style="text-align: right;">threshold_neg</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">127</td>
<td style="text-align: left;">0.7181</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">-0.15</td>
</tr>
<tr class="even">
<td style="text-align: right;">128</td>
<td style="text-align: left;">0.7181</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">-0.15</td>
</tr>
<tr class="odd">
<td style="text-align: right;">142</td>
<td style="text-align: left;">0.7181</td>
<td style="text-align: right;">0.55</td>
<td style="text-align: right;">-0.20</td>
</tr>
<tr class="even">
<td style="text-align: right;">143</td>
<td style="text-align: left;">0.7181</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">-0.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">129</td>
<td style="text-align: left;">0.7174</td>
<td style="text-align: right;">0.65</td>
<td style="text-align: right;">-0.15</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="잘못분류한-문장들" class="level3">
<h3 class="anchored" data-anchor-id="잘못분류한-문장들">잘못분류한 문장들</h3>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3b902a9c22049d18e248" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3b902a9c22049d18e248">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62"],[202,204,205,210,215,216,218,219,222,223,228,230,234,245,249,254,256,272,273,274,275,278,280,281,284,289,290,293,294,296,303,306,309,310,318,321,322,325,329,335,337,339,342,349,350,353,354,355,356,357,358,360,362,367,369,376,378,380,381,384,389,398],["시끄럽고 번잡하지만","관리는 소흘해지는듯","그냥 사람 많음","힐링하러 갔다가 헬링 당한 곳","주차장이 좁아요"," 타는 장소도 너무 멀고,","시민의식 결여.","정비가 시급하다","기다리다가 지침","먹거리 메뉴가 다양치 않고 비쌈.","먼지바람 개쩜","넘 사람들이 많다.","주차공간이 턱없이 부족함.","사람이 느므느므 많으다","이용료가 너무 비싸다","그것이 많이 아쉬웠습니다.","단 매우 붐빔","조잡함. 부조화의 극치","사람 겁나 많아","주차장 비좁음.","밤엔 넘 춥다.","화장실 관리가 필요할거 같네요","볼것도없고그냥뭐동네뒷산갔다온느낌","너무 비싸 사지 못했는데","뭔가 괴랄함.","주변 지저분 소규모","더울때 절때 가지 마세욧!","동물들이 불쌍해요","그만 오세요","주차와.화장실.적었어요","ㅠ 어린이날 좀 속상했어요.","그곳 비추천합니다.","너무 복잡해요.","주차 완전 힘듭니다.","사람이 느므느므 많아요.","주차는 정말 개선되어야함","너무 시끄럽네요.","극악의 주차","그냥 별로임","차도 너무 막혔네요.","꽃을 쑥대밭으로 만들어놓음.","꽃가루 너무 심해요 ㅠㅠ","너무 더웠네요.","박정희 흉상 당장 부셔버려라","넘 안쓰러웠어요.","사람이 너무너무너무 많아요","코스가 아주 단조로움"," 교통,주차 너무힘들어요","축제?때 가는건 강력반댈쎄.","세금 겉어서 선심 잔치 하는곳 .","시설이 노후됫습니다 ㅠㅜ","리모델링이 시급하네요","늘 시위대로 시끄러운 곳.","주차가 개판임.","ㅋㅋ 주차 지옥","재밌어 보이진 않음","농구장이 다 망가졌어요","조금 번잡하고 시끄러워요","사람구경만 졸라하다","비가오니 할게 별로 없음","자동차 소음은 좀 있습니다.","주차 헬"],["부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정","부정"],["중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립","중립"],[0.200000003,-0.100000001,-0.200000003,-0.100000001,-0.100000001,0.100000001,0,-0.100000001,0,0,0,0,-0.200000003,0,-0.100000001,0,0,0.200000003,0.100000001,-0.200000003,0.200000003,-0.200000003,-0.200000003,0.100000001,-0.100000001,0.200000003,0.100000001,0,0,0.100000001,-0.200000003,0.100000001,0.100000001,0,-0.200000003,0,0.100000001,0.200000003,0,0,0,0,0,0.200000003,0.200000003,-0.200000003,0.200000003,0,0,0,-0.100000001,0.100000001,0,0,-0.100000001,0.200000003,0,0.100000001,0,0,0,0.100000001]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>id<\/th>\n      <th>sent_content<\/th>\n      <th>label<\/th>\n      <th>senti_label_google<\/th>\n      <th>senti_score_google<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"lengthMenu":[10,20,50],"dom":"tp","columnDefs":[{"className":"dt-right","targets":[1,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>